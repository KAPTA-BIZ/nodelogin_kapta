<!DOCTYPE html>
<html>

<head>
    <title lang="es">Resultados</title>
    <title lang="en">Results</title>
    <% include partials/head %>
</head>

<body>

    <% include partials/left_column %>

    <div class="main-panel">

        <% include partials/navbar %>
        <div class="content">
            <div class="container-fluid">
                <div class="row">

                    <div class="col-md-12">
                        <h2 class="text-center">
                            <%= data.test_name%>
                        </h2>
                    </div>
                    <br><br><br><br>
                    <div class="col-md-5 my-auto">
                        <div class="card text-center mx-auto">
                            <div class="card-body">
                                <h4 class="card-title" lang="es">
                                    Código de acceso: 
                                    <span><%= data.access_code_used%></span>
                                </h4>
                                <h4 class="card-title" lang="en">
                                        Access code: 
                                        <span><%= data.access_code_used%></span>
                                    </h4>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2 my-auto">
                    </div>

                    <div class="col-md-5 my-auto">
                        <div class="card mx-auto">
                            <div class="card-body">
                                <h1 class="card-title text-center" style="color: <%if (data.percentage>=50){%>green<%}else{%>red<%} %>">
                                    <%= data.percentage%>%
                                </h1>
                                <table style="width:100%">
                                    <tbody>
                                        <tr lang="es">
                                            <td>Puntos:</td>
                                            <td>
                                                <%= data.points_scored%> de
                                                <%= data.points_available%>
                                            </td>
                                        </tr>
                                        <tr lang="en">
                                                <td>Points:</td>
                                                <td>
                                                    <%= data.points_scored%> out of
                                                    <%= data.points_available%>
                                                </td>
                                            </tr>
                                        <tr>
                                            <td lang="es">Duración:</td>
                                            <td lang="en">Duration:</td>
                                            <td>
                                                <%= data.duration%>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td lang="es">Fecha de Inicio:</td>
                                            <td lang="en">Date started:</td>
                                            <td>
                                                <%date=new Date(data.time_started*1000)%>
                                                <%=date.getDate()%>/<%=date.getMonth()+1%>/<%=date.getFullYear()%> <% if(date.getHours()<10){%>0<%}%><%=date.getHours()%>:<% if(date.getMinutes()<10){%>0<%}%><%=date.getMinutes()%>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td lang="es">Fecha de finalización:</td>
                                            <td lang="en">Date finished:</td>
                                            <td>
                                                <%date=new Date(data.time_finished*1000)%>
                                                <%=date.getDate()%>/<%=date.getMonth()+1%>/<%=date.getFullYear()%> <% if(date.getHours()<10){%>0<%}%><%=date.getHours()%>:<% if(date.getMinutes()<10){%>0<%}%><%=date.getMinutes()%>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="card strpied-tabled-with-hover container-fluid">
                            <div class="card-header">
                                <h4 class="card-title" lang="es">Categorias</h4>
                                <h4 class="card-title" lang="en">Categories</h4>
                            </div>
                            <div class="card-body table-full-width table-responsive">
                                <table class="table table-hover table-striped">
                                    <thead>
                                        <tr>
                                            <th style="width: 40%" lang="es">Categoria</th>
                                            <th style="width: 40%" lang="en">Category</th>
                                            <th style="width: 30%" lang="es">Promedio</th>
                                            <th style="width: 30%" lang="en">Average</th>
                                            <th style="width: 10%">&nbsp;&nbsp;&nbsp;&nbsp;</th>
                                            <th style="width: 20%" lang="es">Respuestas</th>
                                            <th style="width: 20%" lang="en">Answers</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% data.category_results.forEach(category=>{%>
                                        <tr style="height: 25px;">
                                            <td>
                                                <%=category.name%>
                                            </td>
                                            <td>
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped <%if (category.percentage>=50){%>bg-success<% }else{%>bg-danger<%} %>" role="progressbar" style="width: <%=category.percentage%>%;" aria-valuenow="<%=category.percentage%>"
                                                        aria-valuemin="0" aria-valuemax="100"></div>
                                                    <div class="progress-value"><b>
                                                            <%=category.percentage%>%</b></div>
                                                </div>

                                            </td>
                                            <td></td>
                                            <td>
                                                <%=category.points_scored%>/
                                                <%=category.points_available%>
                                            </td>
                                        </tr>
                                        <%})%>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="card container-fluid">
                            <div class="card-header">
                                <h4 class="card-title" lang="es">Respuestas</h4>
                                <h4 class="card-title" lang="en">Answers</h4>
                                <h5 class="card-subtitle mb-2 text-muted" lang="es">
                                    <i class="fas fa-check-circle" style="color:#009933"> </i> Respuesta correcta
                                    <i class="fas fa-times-circle" style="color:#d80c0c"> </i> Respuesta incorrecta
                                    <i class="fas fa-arrow-alt-circle-right" style="color:#1120ec"> </i> Opcion
                                    correcta omitida
                                </h5>
                                <h5 class="card-subtitle mb-2 text-muted" lang="en">
                                        <i class="fas fa-check-circle" style="color:#009933"> </i> Correct answer
                                        <i class="fas fa-times-circle" style="color:#d80c0c"> </i> Incorrect answer
                                        <i class="fas fa-arrow-alt-circle-right" style="color:#1120ec"> </i> Missed correct option
                                    </h5>
                            </div>

                            <ul class="nav nav-tabs justify-content-end" id="myTab" role="tablist" lang="es">
                                <li class="nav-item">
                                    <a class="nav-link active" id="all_question-tab" data-toggle="tab" href="#all_question"
                                        role="tab" aria-controls="all_question" aria-selected="true" >Todas</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="corrrect_question-tab" data-toggle="tab" href="#corrrect_question"
                                        role="tab" aria-controls="corrrect_question" aria-selected="false" >Correctas</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="partial_question-tab" data-toggle="tab" href="#partial_question"
                                        role="tab" aria-controls="partial_question" aria-selected="false" >Parcialmente correctas</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="wrong_question-tab" data-toggle="tab" href="#wrong_question"
                                        role="tab" aria-controls="wrong_question" aria-selected="false" >Incorrectas</a>
                                </li>
                            </ul>
                            <ul class="nav nav-tabs justify-content-end" id="myTab" role="tablist" lang="en">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="all_question-tab" data-toggle="tab" href="#all_question"
                                            role="tab" aria-controls="all_question" aria-selected="true" >All</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="corrrect_question-tab" data-toggle="tab" href="#corrrect_question"
                                            role="tab" aria-controls="corrrect_question" aria-selected="false" >Correct</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="partial_question-tab" data-toggle="tab" href="#partial_question"
                                            role="tab" aria-controls="partial_question" aria-selected="false" >Partially correct</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="wrong_question-tab" data-toggle="tab" href="#wrong_question"
                                            role="tab" aria-controls="wrong_question" aria-selected="false" >Incorrect</a>
                                    </li>
                                </ul>

                            <div class="tab-content" id="myTabContent">
                                <!--All Answers-->
                                <div class="tab-pane fade show active" id="all_question" role="tabpanel"
                                    aria-labelledby="all_question-tab">
                                    <% data.questions.forEach((question,index)=>{%>
                                    <div class="card">
                                        <div class="card-header">
                                            <h4 class="card-title" lang="es">Pregunta
                                                <%=index+1%> de
                                                <%=data.questions.length%>
                                            </h4>
                                            <h4 class="card-title" lang="en">Question
                                                    <%=index+1%> of
                                                    <%=data.questions.length%>
                                                </h4>
                                            <h5 class="card-subtitle mb-2 text-muted">
                                                <%=question.category%>
                                            </h5>
                                        </div>
                                        <div class="card-body">
                                            <h5 class="card-title">
                                                <%-question.question%>
                                            </h5>
                                            <p class="card-text">
                                                <% if (question.question_type=="multiplechoice"|| question.question_type == "truefalse"){%>
                                                <ol>
                                                    <% question.options.forEach(option=>{%>
                                                    <li class="<%=option.status%>">
                                                        <div>
                                                            <%-option.option%>
                                                        </div>
                                                    </li>
                                                    <%});%>
                                                </ol>
                                                <% }else if (question.question_type=="freetext"){%>
                                                <ol>
                                                    <li class="answer" style="list-style-type: none">
                                                        <div class="text-muted" lang="es">Respuesta dada:</div>
                                                        <div class="text-muted" lang="en">Answer given:</div>
                                                    </li>
                                                    <li class="<%=question.options.status%>" style="list-style-type: none">
                                                        <div>
                                                            <%-question.options.user_answer%>
                                                        </div>
                                                    </li>
                                                    <li class="answer" style="list-style-type: none">
                                                        <div class="text-muted" lang="es">Respuesta(s) aceptada:</div>
                                                        <div class="text-muted" lang="en">Accepted answer(s):</div>
                                                    </li>
                                                    <li class="answer" style="list-style-type: none">
                                                        <div>
                                                            <%-question.options.options%>
                                                        </div>
                                                    </li>
                                                </ol>
                                                <%}else if (question.question_type=="matching"){ console.log(question.options)%>
                                                    <div class="container">            
                                                        <table class="table table-striped table-condensed">
                                                            <thead>
                                                                    <tr>
                                                                        <th style="width: 36%"></th>
                                                                        <th style="width: 32%" lang="es">Opción correcta</th>
                                                                        <th style="width: 32%" lang="en">Correct answer</th>
                                                                        <th style="width: 32%" lang="es">Opción seleccionada</th>
                                                                        <th style="width: 32%" lang="en">Selected answer</th>
                                                                    </tr>
                                                             </thead>
                                                          <tbody>
                                                              <% question.options.forEach(option=>{%>
                                                                <tr>
                                                                    <td><%=option.clue%></td>
                                                                    <td><%=option.match%></td>
                                                                    <td><li class="<%=option.status%>" style="list-style-type: none"><div><%=option.user_response%></div></li></td>
                                                                </tr>
                                                              <%})%>
                                                          </tbody>
                                                        </table>
                                                      </div>
                                                    <%}%>
                                            </p>
                                        </div>
                                        <div class="card-footer text-muted" lang="es">
                                            Puntos:
                                            <%=question.points_scored%> de
                                            <%=question.points_available%>
                                        </div>
                                        <div class="card-footer text-muted" lang="en">
                                            Points:
                                            <%=question.points_scored%> out of
                                            <%=question.points_available%>
                                        </div>
                                    </div>
                                    <%})%>
                                </div>
                                <!--Correct Answers-->
                                <div class="tab-pane fade" id="corrrect_question" role="tabpanel" aria-labelledby="corrrect_question-tab">
                                    <% data.questions.forEach((question,index)=>{
                                            if(question.result=="correct"){%>
                                                <div class="card">
                                                        <div class="card-header">
                                                            <h4 class="card-title" lang="es">Pregunta
                                                                <%=index+1%> de
                                                                <%=data.questions.length%>
                                                            </h4>
                                                            <h4 class="card-title" lang="en">Question
                                                                    <%=index+1%> of
                                                                    <%=data.questions.length%>
                                                                </h4>
                                                            <h5 class="card-subtitle mb-2 text-muted">
                                                                <%=question.category%>
                                                            </h5>
                                                        </div>
                                                        <div class="card-body">
                                                            <h5 class="card-title">
                                                                <%-question.question%>
                                                            </h5>
                                                            <p class="card-text">
                                                                <% if (question.question_type=="multiplechoice"|| question.question_type == "truefalse"){%>
                                                                <ol>
                                                                    <% question.options.forEach(option=>{%>
                                                                    <li class="<%=option.status%>">
                                                                        <div>
                                                                            <%-option.option%>
                                                                        </div>
                                                                    </li>
                                                                    <%});%>
                                                                </ol>
                                                                <% }else if (question.question_type=="freetext"){%>
                                                                <ol>
                                                                    <li class="answer" style="list-style-type: none">
                                                                        <div class="text-muted" lang="es">Respuesta dada:</div>
                                                                        <div class="text-muted" lang="en">Answer given:</div>
                                                                    </li>
                                                                    <li class="<%=question.options.status%>" style="list-style-type: none">
                                                                        <div>
                                                                            <%-question.options.user_answer%>
                                                                        </div>
                                                                    </li>
                                                                    <li class="answer" style="list-style-type: none">
                                                                        <div class="text-muted" lang="es">Respuesta(s) aceptada:</div>
                                                                        <div class="text-muted" lang="en">Accepted answer(s):</div>
                                                                    </li>
                                                                    <li class="answer" style="list-style-type: none">
                                                                        <div>
                                                                            <%-question.options.options%>
                                                                        </div>
                                                                    </li>
                                                                </ol>
                                                                <%}else if (question.question_type=="matching"){ console.log(question.options)%>
                                                                    <div class="container">            
                                                                        <table class="table table-striped table-condensed">
                                                                            <thead>
                                                                                    <tr>
                                                                                        <th style="width: 36%"></th>
                                                                                        <th style="width: 32%" lang="es">Opción correcta</th>
                                                                                        <th style="width: 32%" lang="en">Correct answer</th>
                                                                                        <th style="width: 32%" lang="es">Opción seleccionada</th>
                                                                                        <th style="width: 32%" lang="en">Selected answer</th>
                                                                                    </tr>
                                                                             </thead>
                                                                          <tbody>
                                                                              <% question.options.forEach(option=>{%>
                                                                                <tr>
                                                                                    <td><%=option.clue%></td>
                                                                                    <td><%=option.match%></td>
                                                                                    <td><li class="<%=option.status%>" style="list-style-type: none"><div><%=option.user_response%></div></li></td>
                                                                                </tr>
                                                                              <%})%>
                                                                          </tbody>
                                                                        </table>
                                                                      </div>
                                                                    <%}%>
                                                            </p>
                                                        </div>
                                                        <div class="card-footer text-muted" lang="es">
                                                            Puntos:
                                                            <%=question.points_scored%> de
                                                            <%=question.points_available%>
                                                        </div>
                                                        <div class="card-footer text-muted" lang="en">
                                                            Points:
                                                            <%=question.points_scored%> out of
                                                            <%=question.points_available%>
                                                        </div>
                                                    </div>
                                    <%}})%>
                                </div>
                                <!-- Partial Answers-->
                                <div class="tab-pane fade" id="partial_question" role="tabpanel" aria-labelledby="partial_question-tab">
                                    <% data.questions.forEach((question,index)=>{
                                            if(question.result=="partial_correct"){%>
                                                <div class="card">
                                                        <div class="card-header">
                                                            <h4 class="card-title" lang="es">Pregunta
                                                                <%=index+1%> de
                                                                <%=data.questions.length%>
                                                            </h4>
                                                            <h4 class="card-title" lang="en">Question
                                                                    <%=index+1%> of
                                                                    <%=data.questions.length%>
                                                                </h4>
                                                            <h5 class="card-subtitle mb-2 text-muted">
                                                                <%=question.category%>
                                                            </h5>
                                                        </div>
                                                        <div class="card-body">
                                                            <h5 class="card-title">
                                                                <%-question.question%>
                                                            </h5>
                                                            <p class="card-text">
                                                                <% if (question.question_type=="multiplechoice"|| question.question_type == "truefalse"){%>
                                                                <ol>
                                                                    <% question.options.forEach(option=>{%>
                                                                    <li class="<%=option.status%>">
                                                                        <div>
                                                                            <%-option.option%>
                                                                        </div>
                                                                    </li>
                                                                    <%});%>
                                                                </ol>
                                                                <% }else if (question.question_type=="freetext"){%>
                                                                <ol>
                                                                    <li class="answer" style="list-style-type: none">
                                                                        <div class="text-muted" lang="es">Respuesta dada:</div>
                                                                        <div class="text-muted" lang="en">Answer given:</div>
                                                                    </li>
                                                                    <li class="<%=question.options.status%>" style="list-style-type: none">
                                                                        <div>
                                                                            <%-question.options.user_answer%>
                                                                        </div>
                                                                    </li>
                                                                    <li class="answer" style="list-style-type: none">
                                                                        <div class="text-muted" lang="es">Respuesta(s) aceptada:</div>
                                                                        <div class="text-muted" lang="en">Accepted answer(s):</div>
                                                                    </li>
                                                                    <li class="answer" style="list-style-type: none">
                                                                        <div>
                                                                            <%-question.options.options%>
                                                                        </div>
                                                                    </li>
                                                                </ol>
                                                                <%}else if (question.question_type=="matching"){ console.log(question.options)%>
                                                                    <div class="container">            
                                                                        <table class="table table-striped table-condensed">
                                                                            <thead>
                                                                                    <tr>
                                                                                        <th style="width: 36%"></th>
                                                                                        <th style="width: 32%" lang="es">Opción correcta</th>
                                                                                        <th style="width: 32%" lang="en">Correct answer</th>
                                                                                        <th style="width: 32%" lang="es">Opción seleccionada</th>
                                                                                        <th style="width: 32%" lang="en">Selected answer</th>
                                                                                    </tr>
                                                                             </thead>
                                                                          <tbody>
                                                                              <% question.options.forEach(option=>{%>
                                                                                <tr>
                                                                                    <td><%=option.clue%></td>
                                                                                    <td><%=option.match%></td>
                                                                                    <td><li class="<%=option.status%>" style="list-style-type: none"><div><%=option.user_response%></div></li></td>
                                                                                </tr>
                                                                              <%})%>
                                                                          </tbody>
                                                                        </table>
                                                                      </div>
                                                                    <%}%>
                                                            </p>
                                                        </div>
                                                        <div class="card-footer text-muted" lang="es">
                                                            Puntos:
                                                            <%=question.points_scored%> de
                                                            <%=question.points_available%>
                                                        </div>
                                                        <div class="card-footer text-muted" lang="en">
                                                            Points:
                                                            <%=question.points_scored%> out of
                                                            <%=question.points_available%>
                                                        </div>
                                                    </div>
                                    <%}})%>
                                </div>
                                <!--Wrong Answers-->
                                <div class="tab-pane fade" id="wrong_question" role="tabpanel" aria-labelledby="wrong_question-tab">
                                    <% data.questions.forEach((question,index)=>{
                                            if(question.result=="incorrect"){%>
                                                <div class="card">
                                                        <div class="card-header">
                                                            <h4 class="card-title" lang="es">Pregunta
                                                                <%=index+1%> de
                                                                <%=data.questions.length%>
                                                            </h4>
                                                            <h4 class="card-title" lang="en">Question
                                                                    <%=index+1%> of
                                                                    <%=data.questions.length%>
                                                                </h4>
                                                            <h5 class="card-subtitle mb-2 text-muted">
                                                                <%=question.category%>
                                                            </h5>
                                                        </div>
                                                        <div class="card-body">
                                                            <h5 class="card-title">
                                                                <%-question.question%>
                                                            </h5>
                                                            <p class="card-text">
                                                                <% if (question.question_type=="multiplechoice"|| question.question_type == "truefalse"){%>
                                                                <ol>
                                                                    <% question.options.forEach(option=>{%>
                                                                    <li class="<%=option.status%>">
                                                                        <div>
                                                                            <%-option.option%>
                                                                        </div>
                                                                    </li>
                                                                    <%});%>
                                                                </ol>
                                                                <% }else if (question.question_type=="freetext"){%>
                                                                <ol>
                                                                    <li class="answer" style="list-style-type: none">
                                                                        <div class="text-muted" lang="es">Respuesta dada:</div>
                                                                        <div class="text-muted" lang="en">Answer given:</div>
                                                                    </li>
                                                                    <li class="<%=question.options.status%>" style="list-style-type: none">
                                                                        <div>
                                                                            <%-question.options.user_answer%>
                                                                        </div>
                                                                    </li>
                                                                    <li class="answer" style="list-style-type: none">
                                                                        <div class="text-muted" lang="es">Respuesta(s) aceptada:</div>
                                                                        <div class="text-muted" lang="en">Accepted answer(s):</div>
                                                                    </li>
                                                                    <li class="answer" style="list-style-type: none">
                                                                        <div>
                                                                            <%-question.options.options%>
                                                                        </div>
                                                                    </li>
                                                                </ol>
                                                                <%}else if (question.question_type=="matching"){ console.log(question.options)%>
                                                                    <div class="container">            
                                                                        <table class="table table-striped table-condensed">
                                                                            <thead>
                                                                                    <tr>
                                                                                        <th style="width: 36%"></th>
                                                                                        <th style="width: 32%" lang="es">Opción correcta</th>
                                                                                        <th style="width: 32%" lang="en">Correct answer</th>
                                                                                        <th style="width: 32%" lang="es">Opción seleccionada</th>
                                                                                        <th style="width: 32%" lang="en">Selected answer</th>
                                                                                    </tr>
                                                                             </thead>
                                                                          <tbody>
                                                                              <% question.options.forEach(option=>{%>
                                                                                <tr>
                                                                                    <td><%=option.clue%></td>
                                                                                    <td><%=option.match%></td>
                                                                                    <td><li class="<%=option.status%>" style="list-style-type: none"><div><%=option.user_response%></div></li></td>
                                                                                </tr>
                                                                              <%})%>
                                                                          </tbody>
                                                                        </table>
                                                                      </div>
                                                                    <%}%>
                                                            </p>
                                                        </div>
                                                        <div class="card-footer text-muted" lang="es">
                                                            Puntos:
                                                            <%=question.points_scored%> de
                                                            <%=question.points_available%>
                                                        </div>
                                                        <div class="card-footer text-muted" lang="en">
                                                            Points:
                                                            <%=question.points_scored%> out of
                                                            <%=question.points_available%>
                                                        </div>
                                                    </div>
                                    <%}})%>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</body>

</html>